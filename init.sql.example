DO $$ 
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_roles WHERE rolname = '${DB_USER}') THEN
        CREATE ROLE ${DB_USER} WITH
        LOGIN
        SUPERUSER
        CREATEDB
        CREATEROLE
        INHERIT
        REPLICATION
        BYPASSRLS
        CONNECTION LIMIT -1
        PASSWORD '${DB_PASS}';
    END IF;
END $$;

DO $$ 
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_database WHERE datname = ${DB_NAME}) THEN
        CREATE DATABASE ${DB_NAME}
            WITH
            OWNER = ${DB_USER}
            TEMPLATE = template0
            ENCODING = 'UTF8'
            ICU_LOCALE = 'en-GB'
            LOCALE_PROVIDER = 'icu'
            CONNECTION LIMIT = -1
            IS_TEMPLATE = False;
    END IF;
END $$;